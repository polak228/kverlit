<kve-headful title='Вход'></kve-headful>

<kve-for-guest>
    <h1>Вход</h1>
    <form>
        <input type='text' name='username' placeholder='Логин'>
        <input type='password' name='password' placeholder='Пароль'>

        <button type='submit'>Войти</button>
    </form>
</kve-for-guest>

<script>
    const { BACKEND_URL } = await this.require('/frontend/kverlit/shared/constants.js');

    const form = this.root.querySelector('form');

    form.username.value = this.cookie.get('username');

    form.addEventListener('submit', e => {
        e.preventDefault();

        const formData = new FormData(e.target);
        const data = Object.fromEntries(new FormData(e.target).entries());
        data.action = 'login';

        data.username = data.username.trim();
        this.cookie.set('username', data.username, 75);

        this.httpPost(BACKEND_URL, data).then(res => {
            this.cookie.set('privateToken', res.privateToken, 75);

            this.router.navigate('/feed');
        }).catch(err => alert(err.message));
    });
</script>
